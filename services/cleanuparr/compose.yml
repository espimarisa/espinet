---
services:
    ###############################################################################
    # Cleanuparr: Automatic cleanup and tasks for 'ARR apps.                      #
    ##############################################################################

    cleanuparr:
        image: ghcr.io/cleanuparr/cleanuparr:2
        container_name: cleanuparr
        hostname: cleanuparr
        restart: unless-stopped
        environment:
            PGID: "${PGID}" # Local group to run as.
            PUID: "${PUID}" # Local user to run as.
            TZ: "${TZ}" # Configures the timezone to use.
        labels:
            caddy: "cleanuparr.${INTERNAL_DOMAIN}" # Reverse proxy to the internal domain.
            caddy.import: "internal cleanuparr:11011" # Reverse proxy internal traffic.
            caddy.tls.ca: "https://acme.zerossl.com/v2/DV90" # Use ZeroSSL for certificates.
            caddy.tls.dns: "cloudflare $CLOUDFLARE_API_TOKEN" # Use Cloudflare for DNS challenges.
            caddy.tls.protocols: "tls1.3" # Require TLS 1.3.
        networks:
            - caddy
            - gluetun
        ports:
            - ${CLEANUPARR_PORT:-11011}:11011/tcp # Web interface.
        security_opt:
            - no-new-privileges:true
        volumes:
            - cleanuparr:/config
networks:
    caddy:
        driver: bridge
        enable_ipv6: false
        external: true
        name: caddy-network # $ docker network create --ipv6=false caddy-network
    gluetun:
        driver: bridge
        enable_ipv6: false
        external: true
        name: gluetun-network # $ docker network create --ipv6=false gluetun-network

volumes:
    cleanuparr:
        external: true
        name: cleanuparr-volume # $ docker volume create cleanuparr-volume
