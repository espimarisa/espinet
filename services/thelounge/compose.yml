services:
    thelounge:
        container_name: "thelounge"
        image: "lscr.io/linuxserver/thelounge:latest"
        hostname: "thelounge"
        restart: "unless-stopped"
        security_opt: ["no-new-privileges:true"]
        environment:
            PGID: "${PGID}" # Group ID to run the container as.
            PUID: "${PUID}" # User ID to run the container as.
            TZ: "${TZ}" # Timezone to configure the container to use.
            UMASK: "${UMASK}" # Default umask permissions to apply to newly created files.
        healthcheck:
            interval: "1m"
            retries: "3"
            start_period: "15s"
            test: ["CMD", "curl", "-f", "http://127.0.0.1:9000"]
            timeout: "3s"
        labels:
            caddy: "${THELOUNGE_URL}" # Tells Caddy to reverse proxy to the external The Lounge URL.
            caddy.reverse_proxy: "thelounge:9000" # Tells Caddy to reverse proxy internal traffic on port 8096.
            caddy.tls.ca: "https://acme.zerossl.com/v2/DV90" # Use ZeroSSL as the CA issuer.
            caddy.tls.dns: "cloudflare $CLOUDFLARE_API_TOKEN" # Use Cloudflare for DNS challenges.
            caddy.tls.protocols: "tls1.3" # Requires clients to support TLS 1.3.
        networks:
            - "external" # External Caddy network.
            - "frontend" # Local frontend network.
        ports:
            - "${THELOUNGE_PORT:-9000}:9000/tcp" # Local web interface.
        volumes:
            - "thelounge:/config" # Configuration and data volume.

networks:
    external:
        driver: "bridge"
        external: "true"
        name: "external-network"
    frontend:
        driver: "bridge"
        external: "true"
        name: "frontend-network"

volumes:
    thelounge:
        name: "thelounge-volume"
        driver_opts:
            device: "${THELOUNGE_PATH}" # Root The Lounge data path.
            o: "bind"
            type: "none"
